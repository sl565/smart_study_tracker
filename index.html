<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°œì¸í™”ëœ í•™ìŠµ ì§„ë„ ì¶”ì ê¸°</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }

        h3 {
            color: #2c3e50;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="text"],
        input[type="email"],
        input[type="number"],
        input[type="date"],
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            background-color: #3498db;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background-color: #2980b9;
        }

        .statistics {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
        }

        .statistics h4 {
            margin-top: 0;
            color: #2c3e50;
        }

        /* ìƒˆë¡œìš´ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .subheader {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .landing-section,
        .motivation-section,
        .psychological-trigger,
        .call-to-action {
            background-color: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        blockquote {
            font-style: italic;
            color: #333;
        }
    </style>
</head>

<body>
    <nav>
        <a href="index.html">í•œêµ­ì–´</a>
        <a href="translated.html">English</a>
    </nav>

    <h3>ë‹¹ì‹ ì˜ ê¿ˆì„ ë°ì´í„°ë¡œ ë§Œë“œëŠ” í•™ìŠµ ë¡œë“œë§µ</h3>
    <p class="subheader">
        ëª©í‘œëŠ” ê¿ˆì´ ì•„ë‹ˆë¼ ê³„íšì…ë‹ˆë‹¤. ì§€ê¸ˆ ë°”ë¡œ ë‹¹ì‹ ì˜ í•™ìŠµ ì—¬ì •ì„ ì¶”ì í•˜ê³  ì„±ê³µì„ ë‹¤ê°€ê°€ì„¸ìš”!
    </p>

    <div class="landing-section">
        <h4>ğŸš€ ë‹¹ì‹ ì˜ í•™ìŠµ, ë°ì´í„°ë¥¼ í™œìš©í•´ ë³´ì„¸ìš”!</h4>
        <p>
            ì¼ë°˜ì ì¸ ì‚¬ëŒì€ ê³„íšì—†ì´ ê³µë¶€í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ,
            ë‹¹ì‹ ì€ ë‹¤ë¦…ë‹ˆë‹¤. ë‹¹ì‹ ì€ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ ì„±ì¥í•©ë‹ˆë‹¤.
        </p>
    </div>

    <div class="motivation-section">
        <h4>ğŸ“Š ë‹¹ì‹ ì˜ í•™ìŠµ, ì‹œê°í™”ë¥¼ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤</h4>
        <p>
            âœ… ì‹¤ì‹œê°„ í•™ìŠµ ì§„í–‰ ìƒí™© ì¶”ì  <br>
            âœ… ëª©í‘œ ë‹¬ì„±ê¹Œì§€ ë‚¨ì€ ì‹œê°„ ê³„ì‚° <br>
            âœ… ê°œì¸ ë§ì¶¤í˜• í•™ìŠµ ì¸ì‚¬ì´íŠ¸ ì œê³µ
        </p>
    </div>

    <div class="form-group">
        <label for="learning-goal">í•™ìŠµ ëª©í‘œ:</label>
        <input id="learning-goal" type="text" placeholder="ì˜ˆ: TOEIC 900ì  ë‹¬ì„±" />
    </div>
    <div class="form-group">
        <label for="subject">ê³¼ëª©:</label>
        <input id="subject" type="text" placeholder="ì˜ˆ: ì˜ì–´, ìˆ˜í•™, ê³¼í•™" />
    </div>
    <div class="form-group">
        <label for="study-time">ì˜¤ëŠ˜ì˜ í•™ìŠµ ì‹œê°„ (ë¶„):</label>
        <input id="study-time" type="number" min="0" />
    </div>
    <div class="form-group">
        <label for="progress">ì§„ë„ (%):</label>
        <input id="progress" type="number" min="0" max="100" />
    </div>
    <div class="form-group">
        <label for="target-date">ëª©í‘œ ë‹¬ì„± ì˜ˆì •ì¼:</label>
        <input id="target-date" type="date" />
    </div>
    <button id="submit-study">í•™ìŠµ ê¸°ë¡ ì €ì¥</button>

    <div class="statistics">
        <h4>í•™ìŠµ ì§„í–‰ ê·¸ë˜í”„</h4>
        <canvas id="studyProgressChart"></canvas>
    </div>

    <div class="statistics">
        <h4>í•™ìŠµ í†µê³„</h4>
        <p>ì´ í•™ìŠµ ì‹œê°„: <span id="total-study-time">0</span> ë¶„</p>
        <p>í‰ê·  ì¼ì¼ í•™ìŠµ ì‹œê°„: <span id="avg-study-time">0</span> ë¶„</p>
        <p>ëª©í‘œ ë‹¬ì„±ê¹Œì§€ ë‚¨ì€ ì‹œê°„: <span id="remaining-time">ê³„ì‚° ì¤‘...</span></p>
    </div>

    <div class="psychological-trigger">
        <blockquote>"ì„±ê³µì€ ìš°ì—°ì´ ì•„ë‹™ë‹ˆë‹¤. ê³„íšê³¼ ì‹¤í–‰ì˜ ê²°ê³¼ì…ë‹ˆë‹¤. ë‹¹ì‹ ì˜ í•™ìŠµì„ ë°ì´í„°ë¡œ ì¦ëª…í•´ë³´ì„¸ìš”."</blockquote>
    </div>

    <div class="call-to-action">
        <h4>ğŸ¯ ì§€ê¸ˆ ë°”ë¡œ ë‹¹ì‹ ì˜ í•™ìŠµ ì—¬ì •ì„ ì‹œì‘í•˜ì„¸ìš”!</h4>
        <p>ë§¤ì¼ì˜ ì‘ì€ ì§„ì „ì´ í° ì„±ê³µìœ¼ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤. ì²« ê±¸ìŒì„ ì§€ê¸ˆ ë‚´ë”›ì–´ ë³´ì„¸ìš”!</p>
    </div>

    <div id="popup" style="display:none;">
        <h1>ê°ì‚¬í•©ë‹ˆë‹¤. </h1>
        <p>ì´ì œëŠ” ìš°ë¦¬ëŠ” ê°™ì€ ë°°ë¥¼ íƒ”ìŠµë‹ˆë‹¤. </p>
    </div>

    <center>
        <p>ì´ë©”ì¼ì„ ë‚¨ê²¨ì£¼ì‹œë©´ ì„œë¹„ìŠ¤ê°€ ëŸ°ì¹­ë˜ì—ˆì„ ë•Œ ì•Œë¦¼ì„ ë“œë¦¬ê² ìŠµë‹ˆë‹¤. </p>
        <input id="submit-email" type="email" placeholder="ì•Œë¦¼ì„ ë°›ìœ¼ì‹¤ ì´ë©”ì¼" /> <br><br>
        <p>ì„œë¹„ìŠ¤ê°€ ì´ë ‡ê²Œ ë˜ì—ˆìœ¼ë©´ ì¢‹ê² ë‹¤ëŠ” ì¡°ì–¸ì„ í•´ ì£¼ì„¸ìš” </p>
        <textarea id="submit-advice" name="Text1" cols="40" rows="5" placeholder="ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì¡°ì–¸ì„ ë‚¨ê²¨ì£¼ì„¸ìš”"></textarea><br>
        <button style="width:350px;" id="submit">ì§€ê¸ˆ ì œì¶œ! </button>
    </center>

    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/busy-load/dist/app.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/busy-load/dist/app.min.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/gh/dinoqqq/simple-popup@master/dist/jquery.simple-popup.min.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/dinoqqq/simple-popup@master/dist/jquery.simple-popup.min.css"
        rel="stylesheet" type="text/css" />

    <script type="application/javascript">
        var ip = "null";
        function getIP(json) {
            console.log(json);
            try {
                ip = json.ip;
            } catch (e) {
                ip = 'unknown';
            }
            return;
        }
    </script>
    <script type="application/javascript" src="https://jsonip.com?format=jsonp&callback=getIP"></script>

    <script>
        // ì¿ í‚¤ì—ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
        function getCookieValue(name) {
            const value = "; " + document.cookie;
            const parts = value.split("; " + name + "=");
            if (parts.length === 2) {
                return parts.pop().split(";").shift();
            }
        }

        // ì¿ í‚¤ì— ê°’ì„ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
        function setCookieValue(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/";
        }

        function getUVfromCookie() {
            // 6ìë¦¬ ì„ì˜ì˜ ë¬¸ìì—´ ìƒì„±
            const hash = Math.random().toString(36).substring(2, 8).toUpperCase();
            // ì¿ í‚¤ì—ì„œ ê¸°ì¡´ í•´ì‹œ ê°’ì„ ê°€ì ¸ì˜´
            const existingHash = getCookieValue("user");
            // ê¸°ì¡´ í•´ì‹œ ê°’ì´ ì—†ìœ¼ë©´, ìƒˆë¡œìš´ í•´ì‹œ ê°’ì„ ì¿ í‚¤ì— ì €ì¥
            if (!existingHash) {
                setCookieValue("user", hash, 180); // ì¿ í‚¤ ë§Œë£Œì¼ì€ 6ê°œì›” 
                return hash;
            } else {
                // ê¸°ì¡´ í•´ì‹œ ê°’ì´ ìˆìœ¼ë©´, ê¸°ì¡´ ê°’ì„ ë°˜í™˜
                return existingHash;
            }
        }

        // Sam pading value to start with 0. eg: 01, 02, .. 09, 10, ..
        function padValue(value) {
            return (value < 10) ? "0" + value : value;
        }

        function getTimeStamp() {
            const date = new Date();

            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const hours = date.getHours();
            const minutes = date.getMinutes();
            const seconds = date.getSeconds();

            const formattedDate = `${padValue(year)}-${padValue(month)}-${padValue(day)} ${padValue(hours)}:${padValue(minutes)}:${padValue(seconds)}`;

            return formattedDate;
        }

        var queryString = location.search;
        const urlParams = new URLSearchParams(queryString);
        const utm = urlParams.get("utm")

        var mobile = 'desktop';
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            // true for mobile device
            mobile = 'mobile';
        }


    </script>

    <script>
        let studyRecords = [];

        // ì°¨íŠ¸ ìƒì„± í•¨ìˆ˜
        function createChart() {
            const ctx = document.getElementById('studyProgressChart').getContext('2d');
            const labels = studyRecords.map((_, index) => `Day ${index + 1}`);
            const data = studyRecords.map(record => record.studyTime);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ì¼ì¼ í•™ìŠµ ì‹œê°„ (ë¶„)',
                        data: data,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // ëª©í‘œ ë‹¬ì„± ì˜ˆì¸¡ í•¨ìˆ˜
        function predictCompletion() {
            if (studyRecords.length < 3) {
                return; // ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŒ
            }

            const avgProgress = studyRecords.reduce((sum, record) => sum + record.progress, 0) / studyRecords.length;
            const daysToCompletion = (100 - avgProgress) / (avgProgress / studyRecords.length);
            const predictedDate = new Date();
            predictedDate.setDate(predictedDate.getDate() + daysToCompletion);

            $('#predicted-completion-date').text(predictedDate.toLocaleDateString());

            const probability = Math.min(avgProgress * studyRecords.length / 100, 1) * 100;
            $('#completion-probability').text(`${probability.toFixed(2)}%`);
        }

        function updateStatistics() {
            if (!studyRecords || studyRecords.length === 0) {
                console.log("No study records available");
                return;
            }
            const totalTime = studyRecords.reduce((sum, record) => sum + parseInt(record.studyTime), 0);
            const avgTime = studyRecords.length > 0 ? totalTime / studyRecords.length : 0;

            $('#total-study-time').text(totalTime);
            $('#avg-study-time').text(avgTime.toFixed(2));

            const targetDate = new Date(studyRecords[studyRecords.length - 1].targetDate);
            const today = new Date();
            const daysRemaining = Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24));

            if (daysRemaining > 0) {
                $('#remaining-time').text(`${daysRemaining} ì¼`);
            } else {
                $('#remaining-time').text('ëª©í‘œì¼ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤.');
            }

            createChart();
            predictCompletion();
        }

        $("#submit-study").on("click", function () {
            $.busyLoadFull("show");

            const learningGoal = $("#learning-goal").val();
            const subject = $("#subject").val();
            const studyTime = $("#study-time").val();
            const progress = $("#progress").val();
            const targetDate = $("#target-date").val();

            if (learningGoal == '' || subject == '' || studyTime == '' || progress == '' || targetDate == '') {
                alert("ëª¨ë“  í•„ë“œë¥¼ ì±„ì›Œì£¼ì„¸ìš”.");
                $.busyLoadFull("hide");
                return;
            }

            // studyRecords ë°°ì—´ì— ìƒˆ ê¸°ë¡ ì¶”ê°€
            studyRecords.push({
                learningGoal: learningGoal,
                subject: subject,
                studyTime: parseInt(studyTime, 10),
                progress: parseFloat(progress),
                targetDate: new Date(targetDate).toISOString()
            });

            updateStatistics();

            var studyData = JSON.stringify({
                "id": getUVfromCookie(),
                "learningGoal": learningGoal,
                "subject": subject,
                "studyTime": parseInt(studyTime, 10), // ë¬¸ìì—´ì„ ì •ìˆ˜ë¡œ ë³€í™˜
                "progress": parseFloat(progress), // ë¬¸ìì—´ì„ ë¶€ë™ì†Œìˆ˜ì ìœ¼ë¡œ ë³€í™˜
                "targetDate": new Date(targetDate).toISOString(), // ISO 8601 í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                "date": new Date(getTimeStamp()).toISOString() // í˜„ì¬ ë‚ ì§œë¥¼ ISO 8601 í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            });

            const addrScript = 'https://script.google.com/macros/s/AKfycby6NcpIkvC5ycqNofeaBNy6nb3Ha0NCC3cQpZyR2EzoL9usfzTC456jn4z9GnAZrs5fsQ/exec';

            axios.get(addrScript + '?action=insert&table=studyProgress&data=' + studyData)
                .then(response => {
                    console.log(JSON.stringify(response));
                    $.busyLoadFull("hide");
                    alert("í•™ìŠµ ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");

                    $('#learning-goal').val('');
                    $('#subject').val('');
                    $('#study-time').val('');
                    $('#progress').val('');
                    $('#target-date').val('');

                    // $('<div id="result" style="font-size:10px; width:200px; word-wrap: break-word; text-overflow: ellipsis; overflow:hidden"></div>').appendTo('#wrapper');
                    // $('#result').text(JSON.stringify(response));
                })
                .catch(error => {
                    console.error('Error:', error);
                    $.busyLoadFull("hide");
                    alert("í•™ìŠµ ê¸°ë¡ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                });
        });

        $(document).ready(function () {
            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° í†µê³„ ì—…ë°ì´íŠ¸
            updateStatistics();
        });
    </script>

    <script>
        /* dataë¥¼ ë§Œë“¤ ë• ëª¨ë“  fieldê°€ ë“¤ì–´ ìˆì–´ì•¼ í•¨ */
        var data = JSON.stringify(
            {
                "id": getUVfromCookie(),
                "landingUrl": window.location.href,
                "ip": ip,
                "referer": document.referrer,
                "time_stamp": getTimeStamp(),
                "utm": utm,
                "device": mobile
            }
        );

        $("#submit").on("click", function () {

            $.busyLoadFull("show");

            const email = $("#submit-email").val();
            const advice = $("#submit-advice").val();

            function validateEmail(email) {
                var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
                return re.test(email);
            }

            if (email == '' || !validateEmail(email)) {
                alert("ì´ë©”ì¼ì´ ìœ íš¨í•˜ì§€ ì•Šì•„ ì•Œë¦¼ì„ ë“œë¦´ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤. ");
                return;
            }

            var finalData = JSON.stringify({
                "id": getUVfromCookie(),
                "email": email,
                "advice": advice
            })

            axios.get('https://script.google.com/macros/s/AKfycby6NcpIkvC5ycqNofeaBNy6nb3Ha0NCC3cQpZyR2EzoL9usfzTC456jn4z9GnAZrs5fsQ/exec?action=insert&table=registration&data=' + finalData)
                .then(response => {
                    console.log(response.data.data);
                    $.busyLoadFull("hide");
                    $.fn.simplePopup({ type: "html", htmlSelector: "#popup" });
                    // alert(JSON.stringify(response));
                    $('#submit-email').val('');
                    $('#submit-advice').val('');
                })
        });

        $(document).ready(function () {

            addrScript = 'https://script.google.com/macros/s/AKfycby6NcpIkvC5ycqNofeaBNy6nb3Ha0NCC3cQpZyR2EzoL9usfzTC456jn4z9GnAZrs5fsQ/exec';

            /* ì˜ ì•ˆë˜ë©´, ajaxëŒ€ì‹  axiosë¥¼ ì‚¬ìš© */
            /* addrScriptì™€ tableì´ë¦„ì„ ë³¸ì¸ ê²ƒì— ë§ì¶”ì–´ ìˆ˜ì •í•´ì•¼ í•¨*/
            /*
            $.ajax({
                    url: addrScript+'?action=insert&table=visitors&data='+data,
                    dataType: 'jsonp',
                    success: function (data) {
                        console.log('ì„±ê³µ - ', JSON.stringify(data));
                    },
                    error: function (xhr) {
                        console.log('ì‹¤íŒ¨ - ', JSON.stringify(xhr));
                    }
            });
            */

            axios.get(addrScript + '?action=insert&table=visitor&data=' + data)
                .then(response => {
                    console.log(JSON.stringify(response));
                    // $('<div id="result" style="font-size:10px; width:200px; word-wrap: break-word; text-overflow: ellipsis; overflow:hidden"></div>').appendTo('#wrapper');
                    $('#result').text(JSON.stringify(response));
                })

        });
    </script>

</body>

</html>