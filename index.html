<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스마트 학습 트래커</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <h1>스마트 학습 트래커</h1>
        <nav>
            <ul>
                <li><a href="#dashboard">대시보드</a></li>
                <li><a href="#goals">목표 설정</a></li>
                <li><a href="#daily-log">일일 기록</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="dashboard">
            <h2>학습 대시보드</h2>
            <div id="progress-chart"></div>
            <div id="recommendations"></div>
        </section>

        <section id="goals">
            <h2>학습 목표 설정</h2>
            <form id="goal-form">
                <label for="subject">과목:</label>
                <input type="text" id="subject" name="subject" required>
                
                <label for="target-date">목표 날짜:</label>
                <input type="date" id="target-date" name="target-date" required>
                
                <button type="submit">목표 설정</button>
            </form>
        </section>

        <section id="daily-log">
            <h2>일일 학습 기록</h2>
            <form id="log-form">
                <label for="study-date">날짜:</label>
                <input type="date" id="study-date" name="study-date" required>
                
                <label for="study-time">학습 시간 (분):</label>
                <input type="number" id="study-time" name="study-time" required>
                
                <label for="notes">메모:</label>
                <textarea id="notes" name="notes"></textarea>
                
                <button type="submit">기록 저장</button>
            </form>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 스마트 학습 트래커. All rights reserved.</p>
    </footer>
    <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbxF-iVXC7psov68UrzPMl3hXpl9QnYHzbGj7qvvUcf3jIkAfuQqB3eFNmURZ5ynys8/exec';

    async function addUser(name, email) {
    const response = await fetch(API_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `action=addUser&name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}`
    });
    return response.text();
    }

    async function addGoal(userId, subject, targetDate) {
    const response = await fetch(API_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `action=addGoal&userId=${encodeURIComponent(userId)}&subject=${encodeURIComponent(subject)}&targetDate=${encodeURIComponent(targetDate)}`
    });
    return response.text();
    }

    async function addDailyLog(userId, date, studyTime, notes) {
    const response = await fetch(API_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `action=addDailyLog&userId=${encodeURIComponent(userId)}&date=${encodeURIComponent(date)}&studyTime=${encodeURIComponent(studyTime)}&notes=${encodeURIComponent(notes)}`
    });
    return response.text();
    }

    async function getUserProgress(userId) {
    const response = await fetch(`${API_URL}?action=getProgress&userId=${encodeURIComponent(userId)}`, {
        method: 'GET',
        mode: 'cors',
    });
    return response.json();
    }

    // 폼 제출 이벤트 리스너 추가
    document.getElementById('goal-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const userId = '1'; // 임시 사용자 ID
    const subject = document.getElementById('subject').value;
    const targetDate = document.getElementById('target-date').value;
    const result = await addGoal(userId, subject, targetDate);
    alert(result);
    });

    document.getElementById('log-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const userId = '1'; // 임시 사용자 ID
    const date = document.getElementById('study-date').value;
    const studyTime = document.getElementById('study-time').value;
    const notes = document.getElementById('notes').value;
    const result = await addDailyLog(userId, date, studyTime, notes);
    alert(result);
    });

    // 페이지 로드 시 사용자 진도 표시
    window.addEventListener('load', async () => {
    const userId = '1'; // 임시 사용자 ID
    const progress = await getUserProgress(userId);
    document.getElementById('progress-chart').innerHTML = `
        <p>총 학습 시간: ${progress.totalStudyTime}분</p>
        <p>학습 기록 수: ${progress.logCount}</p>
    `;
    });
    </script>

    <script src="js/main.js"></script>
</body>
</html>