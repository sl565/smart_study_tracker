<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personalized Learning Progress Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }

        h3 {
            color: #2c3e50;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="text"],
        input[type="email"],
        input[type="number"],
        input[type="date"],
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            background-color: #3498db;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background-color: #2980b9;
        }

        .statistics {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
        }

        .statistics h4 {
            margin-top: 0;
            color: #2c3e50;
        }
        /* ìƒˆë¡œìš´ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .subheader {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        .landing-section, 
        .motivation-section, 
        .psychological-trigger, 
        .call-to-action {
            background-color: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        blockquote {
            font-style: italic;
            color: #333;
        }
    </style>
</head>

<body>
    <nav>
        <a href="index.html">í•œêµ­ì–´</a>
        <a href="translated.html">English</a>
    </nav>

    <h3>Learning Roadmap: Turning Your Dreams into Data</h3>
    <p class="subheader">
        Goals are more than just dreams. Start tracking your learning journey and visualize your success now!
    </p>

    <div class="landing-section">
        <h4>ğŸš€ Win with Data-Driven Learning!</h4>
        <p>Average learners study without a plan. But you're different. We support your data-driven growth.</p>
    </div>

    <div class="motivation-section">
        <h4>ğŸ“Š We Visualize Your Learning</h4>
        <p>
            âœ… Real-time learning progress tracking <br>
            âœ… Time remaining to goal calculation <br>
            âœ… Personalized learning insights
        </p>
    </div>

    <div class="form-group">
        <label for="learning-goal">Learning Goal:</label>
        <input id="learning-goal" type="text" placeholder="eg: TOEIC score 900" />
    </div>
    <div class="form-group">
        <label for="subject">Subject:</label>
        <input id="subject" type="text" placeholder="eg: english, math, science" />
    </div>
    <div class="form-group">
        <label for="study-time">Today's Study Time(min):</label>
        <input id="study-time" type="number" min="0" />
    </div>
    <div class="form-group">
        <label for="progress">Progress (%):</label>
        <input id="progress" type="number" min="0" max="100" />
    </div>
    <div class="form-group">
        <label for="target-date">Target Achievement Date:</label>
        <input id="target-date" type="date" />
    </div>
    <button id="submit-study">Save Learning Record</button>

    <div class="statistics">
        <h4>Learning Statistics</h4>
        <p>Total Study Time: <span id="total-study-time">0</span> min</p>
        <p>Average Daily Study Time: <span id="avg-study-time">0</span> min</p>
        <p>Time Remaing to Goal: <span id="remaining-time">calculating...</span></p>
    </div>

    <div class="psychological-trigger">
        <blockquote>"Success is not a coincidence. It's the result of planning and execution. Prove your learning with
            data."</blockquote>
    </div>

    <div class="call-to-action">
        <h4>ğŸ¯ Start Your Learning Journey Now!</h4>
        <p>Small daily progress leads to big success. Take your first step now!</p>
    </div>

    <div id="popup" style="display:none;">
        <h1>Thank you </h1>
        <p>Now we are on the same boat. </p>
    </div>

    <center>
        <p>Leave your email and we'll notify you when the service launches.</p>
        <input id="submit-email" type="email" placeholder="ì•Œë¦¼ì„ ë°›ìœ¼ì‹¤ ì´ë©”ì¼" /> <br><br>
        <p>Please share your suggestions for the service </p>
        <textarea id="submit-advice" name="Text1" cols="40" rows="5" placeholder="ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì¡°ì–¸ì„ ë‚¨ê²¨ì£¼ì„¸ìš”"></textarea><br>
        <button style="width:350px;" id="submit">Submit Now! </button>
    </center>

    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/busy-load/dist/app.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/busy-load/dist/app.min.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/gh/dinoqqq/simple-popup@master/dist/jquery.simple-popup.min.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/dinoqqq/simple-popup@master/dist/jquery.simple-popup.min.css"
        rel="stylesheet" type="text/css" />

    <script type="application/javascript">
        var ip = "null";
        function getIP(json) {
            console.log(json);
            try {
                ip = json.ip;
            } catch (e) {
                ip = 'unknown';
            }
            return;
        }
    </script>
    <script type="application/javascript" src="https://jsonip.com?format=jsonp&callback=getIP"></script>

    <script>
        // ì¿ í‚¤ì—ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
        function getCookieValue(name) {
            const value = "; " + document.cookie;
            const parts = value.split("; " + name + "=");
            if (parts.length === 2) {
                return parts.pop().split(";").shift();
            }
        }

        // ì¿ í‚¤ì— ê°’ì„ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
        function setCookieValue(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/";
        }

        function getUVfromCookie() {
            // 6ìë¦¬ ì„ì˜ì˜ ë¬¸ìì—´ ìƒì„±
            const hash = Math.random().toString(36).substring(2, 8).toUpperCase();
            // ì¿ í‚¤ì—ì„œ ê¸°ì¡´ í•´ì‹œ ê°’ì„ ê°€ì ¸ì˜´
            const existingHash = getCookieValue("user");
            // ê¸°ì¡´ í•´ì‹œ ê°’ì´ ì—†ìœ¼ë©´, ìƒˆë¡œìš´ í•´ì‹œ ê°’ì„ ì¿ í‚¤ì— ì €ì¥
            if (!existingHash) {
                setCookieValue("user", hash, 180); // ì¿ í‚¤ ë§Œë£Œì¼ì€ 6ê°œì›” 
                return hash;
            } else {
                // ê¸°ì¡´ í•´ì‹œ ê°’ì´ ìˆìœ¼ë©´, ê¸°ì¡´ ê°’ì„ ë°˜í™˜
                return existingHash;
            }
        }

        // Sam pading value to start with 0. eg: 01, 02, .. 09, 10, ..
        function padValue(value) {
            return (value < 10) ? "0" + value : value;
        }

        function getTimeStamp() {
            const date = new Date();

            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const hours = date.getHours();
            const minutes = date.getMinutes();
            const seconds = date.getSeconds();

            const formattedDate = `${padValue(year)}-${padValue(month)}-${padValue(day)} ${padValue(hours)}:${padValue(minutes)}:${padValue(seconds)}`;

            return formattedDate;
        }

        var queryString = location.search;
        const urlParams = new URLSearchParams(queryString);
        const utm = urlParams.get("utm")

        var mobile = 'desktop';
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            // true for mobile device
            mobile = 'mobile';
        }


    </script>

    <script>
        let studyRecords = [];

        function updateStatistics() {
            if (!studyRecords || studyRecords.length === 0) {
                console.log("No study records available");
                return;
            }
            const totalTime = studyRecords.reduce((sum, record) => sum + parseInt(record.studyTime), 0);
            const avgTime = studyRecords.length > 0 ? totalTime / studyRecords.length : 0;

            $('#total-study-time').text(totalTime);
            $('#avg-study-time').text(avgTime.toFixed(2));

            const targetDate = new Date($('#target-date').val());
            const today = new Date();
            const daysRemaining = Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24));

            if (daysRemaining > 0) {
                $('#remaining-time').text(`${daysRemaining} ì¼`);
            } else {
                $('#remaining-time').text('You passed the target date');
            }
        }

        $("#submit-study").on("click", function () {
            $.busyLoadFull("show");

            const learningGoal = $("#learning-goal").val();
            const subject = $("#subject").val();
            const studyTime = $("#study-time").val();
            const progress = $("#progress").val();
            const targetDate = $("#target-date").val();

            if (learningGoal == '' || subject == '' || studyTime == '' || progress == '' || targetDate == '') {
                alert("Fill out the entire section.");
                $.busyLoadFull("hide");
                return;
            }

            var studyData = JSON.stringify({
                "id": getUVfromCookie(),
                "learningGoal": learningGoal,
                "subject": subject,
                "studyTime": parseInt(studyTime, 10), // ë¬¸ìì—´ì„ ì •ìˆ˜ë¡œ ë³€í™˜
                "progress": parseFloat(progress), // ë¬¸ìì—´ì„ ë¶€ë™ì†Œìˆ˜ì ìœ¼ë¡œ ë³€í™˜
                "targetDate": new Date(targetDate).toISOString(), // ISO 8601 í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                "date": new Date(getTimeStamp()).toISOString() // í˜„ì¬ ë‚ ì§œë¥¼ ISO 8601 í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            });

            const addrScript = 'https://script.google.com/macros/s/AKfycby6NcpIkvC5ycqNofeaBNy6nb3Ha0NCC3cQpZyR2EzoL9usfzTC456jn4z9GnAZrs5fsQ/exec';

            axios.get(addrScript + '?action=insert&table=studyProgress&data=' + studyData)
                .then(response => {
                    console.log(JSON.stringify(response));
                    $.busyLoadFull("hide");
                    alert("Learning Record Saved!");

                    studyRecords.push({ studyTime: studyTime });
                    updateStatistics();

                    $('#learning-goal').val('');
                    $('#subject').val('');
                    $('#study-time').val('');
                    $('#progress').val('');

                    // $('<div id="result" style="font-size:10px; width:200px; word-wrap: break-word; text-overflow: ellipsis; overflow:hidden"></div>').appendTo('#wrapper');
                    $('#result').text(JSON.stringify(response));
                })
                .catch(error => {
                    console.error('Error:', error);
                    $.busyLoadFull("hide");
                    alert("Error while saving the learning record");
                });
        });

        $(document).ready(function () {
            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° í†µê³„ ì—…ë°ì´íŠ¸
            updateStatistics();
        });
    </script>

    <script>
        /* dataë¥¼ ë§Œë“¤ ë• ëª¨ë“  fieldê°€ ë“¤ì–´ ìˆì–´ì•¼ í•¨ */
        var data = JSON.stringify(
            {
                "id": getUVfromCookie(),
                "landingUrl": window.location.href,
                "ip": ip,
                "referer": document.referrer,
                "time_stamp": getTimeStamp(),
                "utm": utm,
                "device": mobile
            }
        );

        $("#submit").on("click", function () {

            $.busyLoadFull("show");

            const email = $("#submit-email").val();
            const advice = $("#submit-advice").val();

            function validateEmail(email) {
                var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
                return re.test(email);
            }

            if (email == '' || !validateEmail(email)) {
                alert("Your email has incorrect format");
                return;
            }

            var finalData = JSON.stringify({
                "id": getUVfromCookie(),
                "email": email,
                "advice": advice
            })

            axios.get('https://script.google.com/macros/s/AKfycby6NcpIkvC5ycqNofeaBNy6nb3Ha0NCC3cQpZyR2EzoL9usfzTC456jn4z9GnAZrs5fsQ/exec?action=insert&table=registration&data=' + finalData)
                .then(response => {
                    console.log(response.data.data);
                    $.busyLoadFull("hide");
                    $.fn.simplePopup({ type: "html", htmlSelector: "#popup" });
                    // alert(JSON.stringify(response));
                    $('#submit-email').val('');
                    $('#submit-advice').val('');
                })
        });

        $(document).ready(function () {

            addrScript = 'https://script.google.com/macros/s/AKfycby6NcpIkvC5ycqNofeaBNy6nb3Ha0NCC3cQpZyR2EzoL9usfzTC456jn4z9GnAZrs5fsQ/exec';

            /* ì˜ ì•ˆë˜ë©´, ajaxëŒ€ì‹  axiosë¥¼ ì‚¬ìš© */
            /* addrScriptì™€ tableì´ë¦„ì„ ë³¸ì¸ ê²ƒì— ë§ì¶”ì–´ ìˆ˜ì •í•´ì•¼ í•¨*/
            /*
            $.ajax({
                    url: addrScript+'?action=insert&table=visitors&data='+data,
                    dataType: 'jsonp',
                    success: function (data) {
                        console.log('ì„±ê³µ - ', JSON.stringify(data));
                    },
                    error: function (xhr) {
                        console.log('ì‹¤íŒ¨ - ', JSON.stringify(xhr));
                    }
            });
            */

            axios.get(addrScript + '?action=insert&table=visitor&data=' + data)
                .then(response => {
                    console.log(JSON.stringify(response));
                    // $('<div id="result" style="font-size:10px; width:200px; word-wrap: break-word; text-overflow: ellipsis; overflow:hidden"></div>').appendTo('#wrapper');
                    $('#result').text(JSON.stringify(response));
                })

        });
    </script>

</body>

</html>